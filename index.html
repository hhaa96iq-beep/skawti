<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© â€” Ø§Ù„Ù…Ø®Ø²Ù† â€¢ Ø§Ù„ØªØ³ÙˆÙ‚ â€¢ Ø§Ù„Ù…Ù‡Ø§Ù… â€¢ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</title>

  <!--
    âœ… Ù…Ù„Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· (HTML+CSS+JS) â€” ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
    âœ… ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ LocalStorage (Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±)
    âœ… ÙˆØ§Ø¬Ù‡Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© (Views) Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©
    âœ… Ø·Ø¨Ø§Ø¹Ø© A4 Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚
  -->

  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --brand:#7dd3fc;
      --brand2:#a78bfa;
      --ok:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --r:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 85% -10%, rgba(167,139,250,.25), transparent 60%),
        radial-gradient(900px 600px at 10% 0%, rgba(125,211,252,.18), transparent 60%),
        linear-gradient(180deg, #060a14, #0b1220 55%, #070b14);
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Ø®Ù„ÙÙŠØ© Ø­Ø¨ÙŠØ¨Ø§Øª */
    .grain{
      pointer-events:none;
      position:fixed;
      inset:0;
      opacity:.12;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
    }

    .app{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 60px;
    }

    /* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
    .topbar{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: calc(var(--r) + 6px);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      position:sticky;
      top:12px;
      z-index:10;
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 240px;
    }
    .logo{
      width:42px; height:42px;
      border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(125,211,252,.9), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(167,139,250,.9), transparent 55%),
        rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      transform: rotate(25deg);
      animation: shimmer 2.8s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{ transform: translateX(-35%) rotate(25deg); opacity:.0}
      30%{opacity:.8}
      55%{opacity:.35}
      100%{ transform: translateX(35%) rotate(25deg); opacity:0}
    }

    .brand h1{
      font-size:16px; margin:0;
      letter-spacing:.2px;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px; color:var(--muted);
    }

    .nav{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btn{
      appearance:none; border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius: 999px;
      padding:10px 12px;
      cursor:pointer;
      transition: transform .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
      display:inline-flex; align-items:center; gap:8px;
      font-size:13px;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background:rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .btn:active{ transform: translateY(0px) scale(.99); }
    .btn.primary{
      border-color: rgba(125,211,252,.35);
      background: linear-gradient(180deg, rgba(125,211,252,.18), rgba(255,255,255,.06));
    }
    .btn.danger{
      border-color: rgba(251,113,133,.35);
      background: linear-gradient(180deg, rgba(251,113,133,.16), rgba(255,255,255,.05));
    }
    .btn.ok{
      border-color: rgba(52,211,153,.35);
      background: linear-gradient(180deg, rgba(52,211,153,.16), rgba(255,255,255,.05));
    }

    .content{
      margin-top:16px;
      position:relative;
    }

    /* Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª (Views) */
    .view{
      display:none;
      animation: viewIn .35s cubic-bezier(.2,.8,.2,1) both;
    }
    .view.active{ display:block; }
    @keyframes viewIn{
      from{ opacity:0; transform: translateY(12px); filter: blur(6px);}
      to{ opacity:1; transform: translateY(0); filter: blur(0);}
    }

    /* Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    .hero{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: calc(var(--r) + 10px);
      padding:22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-120px;
      background:
        radial-gradient(circle at 85% 20%, rgba(125,211,252,.22), transparent 55%),
        radial-gradient(circle at 15% 80%, rgba(167,139,250,.18), transparent 55%);
      filter: blur(12px);
      animation: floaty 8s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{transform: translateY(0px) scale(1)}
      50%{transform: translateY(10px) scale(1.02)}
    }
    .hero > *{ position:relative; }
    .hero h2{
      margin:0 0 6px;
      font-size:18px;
    }
    .hero p{
      margin:0;
      color:var(--muted);
      line-height:1.7;
      font-size:13px;
    }

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    .tile{
      grid-column: span 6;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: calc(var(--r) + 6px);
      padding:16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      cursor:pointer;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      position:relative;
      overflow:hidden;
      min-height: 110px;
    }
    .tile:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
    }
    .tile:active{ transform: translateY(0px) scale(.99); }
    .tile .kicker{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:8px;
    }
    .badge{
      font-size:12px;
      color: rgba(255,255,255,.85);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    .tile h3{
      margin:0 0 6px;
      font-size:16px;
    }
    .tile p{
      margin:0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.6;
    }

    /* Ø£Ù‚Ø³Ø§Ù… Ø¹Ø§Ù…Ø© */
    .section{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: calc(var(--r) + 10px);
      padding:16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .sectionHeader{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .sectionHeader h2{
      margin:0;
      font-size:18px;
    }
    .sectionHeader .sub{
      margin:4px 0 0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.6;
    }
    .stack{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    .panel{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:12px;
    }

    /* Ø­Ù‚ÙˆÙ„ */
    .row{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
      align-items:end;
    }
    .field{
      grid-column: span 3;
      display:flex; flex-direction:column; gap:6px;
    }
    .field.w4{ grid-column: span 4; }
    .field.w6{ grid-column: span 6; }
    .field.w12{ grid-column: span 12; }

    label{
      font-size:12px; color: var(--muted);
    }
    input, select, textarea{
      width:100%;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding:11px 12px;
      outline:none;
      transition: border-color .18s ease, transform .18s ease, background .18s ease;
      font-size:13px;
    }
    textarea{ min-height: 86px; resize: vertical; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(125,211,252,.45);
      background: rgba(0,0,0,.22);
    }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,.35); }

    .divider{
      height:1px;
      background: rgba(255,255,255,.10);
      margin:14px 0;
    }

    /* Ø¬Ø¯ÙˆÙ„ */
    .tableWrap{ overflow:auto; border-radius: var(--r); border:1px solid rgba(255,255,255,.12); }
    table{
      width:100%;
      border-collapse: collapse;
      min-width: 760px;
      background: rgba(0,0,0,.10);
    }
    th, td{
      padding:10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      font-size:13px;
      vertical-align: middle;
      white-space:nowrap;
    }
    th{
      text-align:right;
      color: rgba(255,255,255,.80);
      background: rgba(255,255,255,.05);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    td .mini{
      font-size:12px; color: var(--muted);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      font-size:12px;
      color: rgba(255,255,255,.85);
    }
    .pill.ok{ border-color: rgba(52,211,153,.28); background: rgba(52,211,153,.08); }
    .pill.warn{ border-color: rgba(251,191,36,.28); background: rgba(251,191,36,.08); }
    .pill.bad{ border-color: rgba(251,113,133,.28); background: rgba(251,113,133,.08); }

    .right{ text-align:left; } /* RTL: left Ù‡Ùˆ Ø§Ù„Ø·Ø±Ù Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¨ØµØ±ÙŠØ§Ù‹ */
    .muted{ color: var(--muted); }

    /* Ù…ÙˆØ¯Ø§Ù„ */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.55);
      z-index: 50;
      padding: 16px;
    }
    .modal.open{ display:grid; }
    .modalCard{
      width: min(820px, 100%);
      border:1px solid rgba(255,255,255,.16);
      background: rgba(10,15,28,.88);
      border-radius: calc(var(--r) + 10px);
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      overflow:hidden;
      animation: pop .25s cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes pop{
      from{ transform: translateY(8px) scale(.98); opacity:0; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }
    .modalHead{
      display:flex; justify-content:space-between; align-items:center;
      padding: 14px 14px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHead h3{ margin:0; font-size:16px; }
    .modalBody{ padding: 14px; }
    .modalFoot{
      padding: 14px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;
    }

    /* Ù…Ù‡Ø§Ù… */
    .tasksGrid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      margin-top: 10px;
    }
    .taskCard{
      grid-column: span 6;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding: 12px;
      transition: transform .18s ease, border-color .18s ease;
    }
    .taskCard:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.18); }
    .taskTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .taskTitle{ margin:0; font-size:14px; line-height:1.5; }
    .taskMeta{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .taskActions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }

    /* Ù‚ÙˆØ§Ø¦Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© */
    .futureLists{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      margin-top: 10px;
    }
    .futureCard{
      grid-column: span 6;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding: 12px;
    }
    .futureCard h4{ margin:0 0 6px; font-size:15px; }
    .futureSub{
      margin:0 0 10px;
      color: var(--muted);
      font-size:12.5px;
      line-height:1.6;
    }
    .subitems{
      border-top:1px solid rgba(255,255,255,.10);
      margin-top:10px;
      padding-top:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .subitem{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      border-radius: 14px;
    }

    /* Ø±ÙŠØ³Ø¨ÙˆÙ†Ø³Ù */
    @media (max-width: 860px){
      .tile{ grid-column: span 12; }
      .field{ grid-column: span 6; }
      .taskCard, .futureCard{ grid-column: span 12; }
      .brand{ min-width:auto; }
    }
    @media (max-width: 520px){
      .field{ grid-column: span 12; }
      .nav{ justify-content:flex-start; }
    }

    /* Ø·Ø¨Ø§Ø¹Ø© A4 */
    @media print{
      body{ background:white !important; color:black !important; }
      .grain, .topbar, .noPrint{ display:none !important; }
      .section, .panel, .hero{ box-shadow:none !important; border:1px solid #ddd !important; background:white !important; }
      table{ min-width: 0 !important; }
      th{ position: static !important; background: #f3f3f3 !important; color:#000 !important; }
      .content{ margin-top:0 !important; }
      .printTitle{
        display:block !important;
        text-align:center;
        font-size:16px;
        font-weight:700;
        margin: 0 0 10px;
      }
    }
    .printTitle{ display:none; }
  </style>
</head>

<body>
  <div class="grain"></div>

  <div class="app">
    <div class="topbar noPrint">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø´Ø®ØµÙŠØ©</h1>
          <p>Ù…Ø®Ø²Ù† â€¢ Ù‚Ø§Ø¦Ù…Ø© ØªØ³ÙˆÙ‚ â€¢ Ù‚ÙˆØ§Ø¦Ù… Ù…Ù‡Ø§Ù… â€¢ Ù‚ÙˆØ§Ø¦Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</p>
        </div>
      </div>

      <div class="nav">
        <button class="btn primary" onclick="go('home')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="btn" onclick="go('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</button>
        <button class="btn" onclick="go('shopping')">ğŸ§¾ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>
        <button class="btn" onclick="go('tasks')">âœ… Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù‡Ø§Ù…</button>
        <button class="btn" onclick="go('future')">ğŸ—‚ï¸ Ù‚ÙˆØ§Ø¦Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</button>
      </div>
    </div>

    <div class="content">
      <!-- HOME -->
      <section id="view-home" class="view active">
        <div class="hero">
          <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹</h2>
          <p>
            Ù‡Ø°Ù‡ ØµÙØ­Ø© ÙˆÙŠØ¨ ØªØ¹Ù…Ù„ ÙƒÙ€ â€œØªØ·Ø¨ÙŠÙ‚â€ Ø¨ÙˆØ§Ø¬Ù‡Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©. ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ­ÙØ¸ Ø¯Ø§Ø®Ù„ Ø¬Ù‡Ø§Ø²Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (LocalStorage).
            Ø§Ø®ØªØ± Ù‚Ø³Ù…Ù‹Ø§ Ù„Ù„Ø¨Ø¯Ø¡.
          </p>

          <div class="grid" style="margin-top:14px;">
            <div class="tile" onclick="go('inventory')">
              <div class="kicker">
                <span class="badge">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ…</span>
                <span class="pill">CRUD</span>
              </div>
              <h3>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</h3>
              <p>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§ØªØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø­Ø°ÙØŒ ÙˆØ­Ø³Ø§Ø¨ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</p>
            </div>

            <div class="tile" onclick="go('shopping')">
              <div class="kicker">
                <span class="badge">Ø¨Ø­Ø« + Ø·Ø¨Ø§Ø¹Ø©</span>
                <span class="pill">A4</span>
              </div>
              <h3>ğŸ§¾ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
              <p>Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†ØŒ ÙƒÙ…ÙŠØ§ØªØŒ Ù…Ø¬Ù…ÙˆØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙˆØ·Ø¨Ø§Ø¹Ø©.</p>
            </div>

            <div class="tile" onclick="go('tasks')">
              <div class="kicker">
                <span class="badge">ØªÙ†Ø¸ÙŠÙ…</span>
                <span class="pill ok">ÙŠÙˆÙ…ÙŠ/Ø£Ø³Ø¨ÙˆØ¹ÙŠ/Ø´Ù‡Ø±ÙŠ</span>
              </div>
              <h3>âœ… Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
              <p>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ø§Ù… Ù…Ø¹ ØªÙ…ÙŠÙŠØ²ØŒ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°ÙØŒ ÙˆØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§Ù„Ø©.</p>
            </div>

            <div class="tile" onclick="go('future')">
              <div class="kicker">
                <span class="badge">ØªØ®Ø·ÙŠØ·</span>
                <span class="pill warn">ØªÙƒÙ„ÙØ© ÙØ±Ø¯ÙŠØ©/Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</span>
              </div>
              <h3>ğŸ—‚ï¸ Ù‚ÙˆØ§Ø¦Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</h3>
              <p>Ù‚ÙˆØ§Ø¦Ù… Ø±Ø¦ÙŠØ³ÙŠØ© + Ù‚ÙˆØ§Ø¦Ù… ÙØ±Ø¹ÙŠØ© Ù…Ø¹ Ø­Ø³Ø§Ø¨ ØªÙƒØ§Ù„ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- INVENTORY -->
      <section id="view-inventory" class="view">
        <div class="section">
          <div class="sectionHeader">
            <div>
              <h2>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</h2>
              <div class="sub">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ / Ø­Ø°Ù Ù…Ù†ØªØ¬Ø§Øª â€” (Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ØŒ Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©ØŒ Ø§Ù„ÙƒÙ…ÙŠØ©ØŒ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­)</div>
            </div>
            <div class="stack">
              <button class="btn ok" onclick="openInventoryModal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
              <button class="btn danger" onclick="confirmReset('inventory')">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ø®Ø²Ù†</button>
            </div>
          </div>

          <div class="panel">
            <div class="row">
              <div class="field w6">
                <label>Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</label>
                <input id="invSearch" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬..." oninput="renderInventory()" />
              </div>
              <div class="field w3">
                <label>ØªØ±ØªÙŠØ¨</label>
                <select id="invSort" onchange="renderInventory()">
                  <option value="name_asc">Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</option>
                  <option value="name_desc">Ø§Ù„Ø§Ø³Ù… (ÙŠ-Ø£)</option>
                  <option value="qty_desc">Ø§Ù„ÙƒÙ…ÙŠØ© (Ø§Ù„Ø£ÙƒØ«Ø±)</option>
                  <option value="qty_asc">Ø§Ù„ÙƒÙ…ÙŠØ© (Ø§Ù„Ø£Ù‚Ù„)</option>
                  <option value="wholesale_desc">Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© (Ø§Ù„Ø£Ø¹Ù„Ù‰)</option>
                  <option value="wholesale_asc">Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© (Ø§Ù„Ø£Ù‚Ù„)</option>
                </select>
              </div>
              <div class="field w3">
                <label>Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹</label>
                <div class="pill" id="invSummary">â€”</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                  <th>Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                  <th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
                  <th class="right">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="invTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SHOPPING -->
      <section id="view-shopping" class="view">
        <div class="section">
          <div class="sectionHeader">
            <div>
              <h2>ğŸ§¾ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
              <div class="sub">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù† Ø¨Ø§Ù„Ø¨Ø­Ø«ØŒ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ©ØŒ Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ù…Ø¬Ù…ÙˆØ¹ ÙƒÙ„ÙŠØŒ ÙˆØ·Ø¨Ø§Ø¹Ø© A4.</div>
            </div>
            <div class="stack">
              <button class="btn ok" onclick="openAddToShoppingModal()">â• Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
              <button class="btn" onclick="printShopping()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© A4</button>
              <button class="btn danger" onclick="confirmReset('shopping')">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
          </div>

          <div class="printTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚</div>

          <div class="panel">
            <div class="row">
              <div class="field w6">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input id="shopNote" placeholder="Ù…Ø«Ø§Ù„: ØªØ§Ø±ÙŠØ® / Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ / Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." oninput="saveShopNote()"/>
              </div>
              <div class="field w6">
                <label>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</label>
                <div class="pill ok" id="shopTotal">0</div>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                  <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                  <th>Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©</th>
                  <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ</th>
                  <th class="right">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="shopTbody"></tbody>
            </table>
          </div>

          <div style="margin-top:10px" class="muted">
            <span class="pill">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ = Ø§Ù„ÙƒÙ…ÙŠØ© Ã— Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©</span>
            <span class="pill" id="shopNotePreview" style="margin-right:8px">â€”</span>
          </div>
        </div>
      </section>

      <!-- TASKS -->
      <section id="view-tasks" class="view">
        <div class="section">
          <div class="sectionHeader">
            <div>
              <h2>âœ… Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
              <div class="sub">Ù…Ù‡Ø§Ù… ÙŠÙˆÙ…ÙŠØ©/Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©/Ø´Ù‡Ø±ÙŠØ© â€” Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„/Ø­Ø°Ù/ØªÙ…ÙŠÙŠØ²/Ø¥ÙƒÙ…Ø§Ù„.</div>
            </div>
            <div class="stack">
              <button class="btn ok" onclick="openTaskModal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
              <button class="btn danger" onclick="confirmReset('tasks')">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
            </div>
          </div>

          <div class="panel">
            <div class="row">
              <div class="field w6">
                <label>Ø¨Ø­Ø«</label>
                <input id="taskSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ù…Ø©..." oninput="renderTasks()"/>
              </div>
              <div class="field w3">
                <label>ÙÙ„ØªØ±Ø©</label>
                <select id="taskFilter" onchange="renderTasks()">
                  <option value="all">Ø§Ù„ÙƒÙ„</option>
                  <option value="daily">ÙŠÙˆÙ…ÙŠØ©</option>
                  <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</option>
                  <option value="monthly">Ø´Ù‡Ø±ÙŠØ©</option>
                  <option value="star">Ù…Ù…ÙŠØ²Ø© â­</option>
                  <option value="done">Ù…ÙƒØªÙ…Ù„Ø© âœ…</option>
                  <option value="todo">ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©</option>
                </select>
              </div>
              <div class="field w3">
                <label>Ù…Ù„Ø®Øµ</label>
                <div class="pill" id="taskSummary">â€”</div>
              </div>
            </div>
          </div>

          <div class="tasksGrid" id="tasksGrid"></div>
        </div>
      </section>

      <!-- FUTURE -->
      <section id="view-future" class="view">
        <div class="section">
          <div class="sectionHeader">
            <div>
              <h2>ğŸ—‚ï¸ Ù‚ÙˆØ§Ø¦Ù… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</h2>
              <div class="sub">Ø£Ù†Ø´Ø¦ Ù‚Ø§Ø¦Ù…Ø© Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ¨Ø¯Ø§Ø®Ù„Ù‡Ø§ Ø¹Ù†Ø§ØµØ± ÙØ±Ø¹ÙŠØ© Ù…Ø¹ ØªÙƒÙ„ÙØ© ÙØ±Ø¯ÙŠØ© ÙˆØ¥Ø¬Ù…Ø§Ù„ÙŠØ©.</div>
            </div>
            <div class="stack">
              <button class="btn ok" onclick="openFutureListModal()">â• Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
              <button class="btn danger" onclick="confirmReset('future')">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
            </div>
          </div>

          <div class="panel">
            <div class="row">
              <div class="field w6">
                <label>Ø¨Ø­Ø« Ø¨Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…</label>
                <input id="futureSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©..." oninput="renderFuture()"/>
              </div>
              <div class="field w6">
                <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…</label>
                <div class="pill warn" id="futureGrandTotal">0</div>
              </div>
            </div>
          </div>

          <div class="futureLists" id="futureLists"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- MODALS -->
  <div id="modal" class="modal" onclick="if(event.target.id==='modal') closeModal()">
    <div class="modalCard">
      <div class="modalHead">
        <h3 id="modalTitle">â€”</h3>
        <button class="btn" onclick="closeModal()">âœ–</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
      <div class="modalFoot" id="modalFoot"></div>
    </div>
  </div>

<script>
/* ===========================
   Utils + Storage
=========================== */
const LS_KEYS = {
  inventory: "APP_INV_V1",
  shopping:  "APP_SHOP_V1",
  shopNote:  "APP_SHOP_NOTE_V1",
  tasks:     "APP_TASKS_V1",
  future:    "APP_FUTURE_V1",
};

const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);
const nfmt = (x) => {
  const n = Number(x || 0);
  if (!isFinite(n)) return "0";
  return n.toLocaleString("ar-IQ");
};
const toNum = (v) => {
  const n = Number(String(v).replace(/[^\d.-]/g,""));
  return isFinite(n) ? n : 0;
};
const load = (key, fallback) => {
  try{
    const raw = localStorage.getItem(key);
    if(!raw) return fallback;
    return JSON.parse(raw);
  }catch(e){
    return fallback;
  }
};
const save = (key, value) => localStorage.setItem(key, JSON.stringify(value));

let state = {
  inventory: load(LS_KEYS.inventory, []),
  shopping:  load(LS_KEYS.shopping,  []),
  shopNote:  localStorage.getItem(LS_KEYS.shopNote) || "",
  tasks:     load(LS_KEYS.tasks,     []),
  future:    load(LS_KEYS.future,    []),
};

/* ===========================
   Navigation (Views)
=========================== */
function go(view){
  const ids = ["home","inventory","shopping","tasks","future"];
  ids.forEach(v=>{
    document.getElementById("view-"+v).classList.toggle("active", v===view);
  });
  // Render on enter
  if(view==="inventory") renderInventory();
  if(view==="shopping") renderShopping();
  if(view==="tasks") renderTasks();
  if(view==="future") renderFuture();
  window.scrollTo({top:0, behavior:"smooth"});
}

/* ===========================
   Modal helpers
=========================== */
function openModal(title, bodyHTML, footHTML){
  document.getElementById("modalTitle").textContent = title;
  document.getElementById("modalBody").innerHTML = bodyHTML;
  document.getElementById("modalFoot").innerHTML = footHTML || "";
  document.getElementById("modal").classList.add("open");
}
function closeModal(){
  document.getElementById("modal").classList.remove("open");
}
function toast(msg){
  // Toast Ø¨Ø³ÙŠØ·
  const t = document.createElement("div");
  t.textContent = msg;
  Object.assign(t.style,{
    position:"fixed", bottom:"18px", left:"18px", right:"18px",
    padding:"12px 14px", background:"rgba(10,15,28,.92)",
    border:"1px solid rgba(255,255,255,.14)",
    borderRadius:"16px", color:"rgba(255,255,255,.92)",
    boxShadow:"0 18px 40px rgba(0,0,0,.45)",
    zIndex:999, backdropFilter:"blur(10px)",
    transform:"translateY(12px)", opacity:"0",
    transition:"all .22s ease",
    textAlign:"center"
  });
  document.body.appendChild(t);
  requestAnimationFrame(()=>{ t.style.transform="translateY(0)"; t.style.opacity="1"; });
  setTimeout(()=>{
    t.style.transform="translateY(10px)";
    t.style.opacity="0";
    setTimeout(()=>t.remove(), 250);
  }, 1600);
}

/* ===========================
   Reset confirm
=========================== */
function confirmReset(which){
  const labels = {
    inventory:"Ù…Ø³Ø­ Ø§Ù„Ù…Ø®Ø²Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ",
    shopping:"Ù…Ø³Ø­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ",
    tasks:"Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…ØŸ",
    future:"Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©ØŸ",
  };
  openModal("ØªØ£ÙƒÙŠØ¯", `
    <div class="panel">
      <p style="margin:0; line-height:1.8">
        ${labels[which] || "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ"}<br>
        <span class="muted">Ù„Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù.</span>
      </p>
    </div>
  `, `
    <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    <button class="btn danger" onclick="doReset('${which}')">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
  `);
}
function doReset(which){
  if(which==="inventory"){ state.inventory=[]; save(LS_KEYS.inventory, state.inventory); renderInventory(); }
  if(which==="shopping"){ state.shopping=[]; save(LS_KEYS.shopping, state.shopping); renderShopping(); }
  if(which==="tasks"){ state.tasks=[]; save(LS_KEYS.tasks, state.tasks); renderTasks(); }
  if(which==="future"){ state.future=[]; save(LS_KEYS.future, state.future); renderFuture(); }
  closeModal();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
}

/* ===========================
   INVENTORY (CRUD)
=========================== */
function openInventoryModal(editId=null){
  const isEdit = !!editId;
  const item = isEdit ? state.inventory.find(x=>x.id===editId) : null;

  const body = `
    <div class="row">
      <div class="field w6">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input id="m_inv_name" placeholder="Ù…Ø«Ø§Ù„: ÙƒÙŠØ¨Ù„ ØªØ§ÙŠØ¨ Ø³ÙŠ" value="${item?.name ? escapeHtml(item.name) : ""}">
      </div>
      <div class="field w3">
        <label>Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©</label>
        <input id="m_inv_wh" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 2500" value="${item ? item.wholesale : ""}">
      </div>
      <div class="field w3">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input id="m_inv_qty" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 10" value="${item ? item.qty : ""}">
      </div>
      <div class="field w3">
        <label>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</label>
        <input id="m_inv_profit" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 500" value="${item ? item.profit : ""}">
      </div>
      <div class="field w9">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="m_inv_note" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø©â€¦" value="${item?.note ? escapeHtml(item.note) : ""}">
      </div>
    </div>
  `;
  const foot = `
    <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    ${isEdit ? `<button class="btn danger" onclick="deleteInventory('${editId}')">Ø­Ø°Ù</button>` : ``}
    <button class="btn ok" onclick="${isEdit ? `saveInventoryEdit('${editId}')` : `saveInventoryNew()`}">${isEdit ? "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„" : "Ø¥Ø¶Ø§ÙØ©"}</button>
  `;
  openModal(isEdit ? "ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬" : "Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬", body, foot);
}
function saveInventoryNew(){
  const name = val("m_inv_name").trim();
  const wholesale = toNum(val("m_inv_wh"));
  const qty = Math.max(0, Math.floor(toNum(val("m_inv_qty"))));
  const profit = toNum(val("m_inv_profit"));
  const note = val("m_inv_note").trim();

  if(!name){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"); return; }

  const exists = state.inventory.some(x => x.name.trim().toLowerCase() === name.toLowerCase());
  if(exists){
    toast("Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§ (ØºÙŠÙ‘Ø± Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù…Ù†ØªØ¬)");
    return;
  }

  state.inventory.unshift({ id:uid(), name, wholesale, qty, profit, note, createdAt: Date.now() });
  save(LS_KEYS.inventory, state.inventory);
  closeModal();
  renderInventory();
  toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
}
function saveInventoryEdit(id){
  const idx = state.inventory.findIndex(x=>x.id===id);
  if(idx<0) return;

  const name = val("m_inv_name").trim();
  const wholesale = toNum(val("m_inv_wh"));
  const qty = Math.max(0, Math.floor(toNum(val("m_inv_qty"))));
  const profit = toNum(val("m_inv_profit"));
  const note = val("m_inv_note").trim();
  if(!name){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"); return; }

  // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø§Ø³Ù… Ù…Ø¹ Ù…Ù†ØªØ¬ Ø¢Ø®Ø±
  const clash = state.inventory.some(x => x.id!==id && x.name.trim().toLowerCase()===name.toLowerCase());
  if(clash){
    toast("Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù…Ù†ØªØ¬ Ø¢Ø®Ø±");
    return;
  }

  state.inventory[idx] = { ...state.inventory[idx], name, wholesale, qty, profit, note, updatedAt: Date.now() };
  save(LS_KEYS.inventory, state.inventory);
  closeModal();
  renderInventory();
  toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
}
function deleteInventory(id){
  state.inventory = state.inventory.filter(x=>x.id!==id);
  save(LS_KEYS.inventory, state.inventory);

  // Ø£ÙŠØ¶Ø§Ù‹ Ù†Ø­Ø°Ù Ø£ÙŠ Ø¹Ù†Ø§ØµØ± ØªØ³ÙˆÙ‚ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ Ù…Ø­Ø°ÙˆÙ (Ø­ÙØ§Ø¸Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§ÙØ©)
  state.shopping = state.shopping.filter(r => r.invId !== id);
  save(LS_KEYS.shopping, state.shopping);

  closeModal();
  renderInventory();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
}
function renderInventory(){
  const q = (document.getElementById("invSearch")?.value || "").trim().toLowerCase();
  const sort = document.getElementById("invSort")?.value || "name_asc";

  let items = [...state.inventory];
  if(q){
    items = items.filter(x => x.name.toLowerCase().includes(q));
  }

  items.sort((a,b)=>{
    switch(sort){
      case "name_desc": return b.name.localeCompare(a.name,'ar');
      case "qty_desc": return (b.qty||0)-(a.qty||0);
      case "qty_asc": return (a.qty||0)-(b.qty||0);
      case "wholesale_desc": return (b.wholesale||0)-(a.wholesale||0);
      case "wholesale_asc": return (a.wholesale||0)-(b.wholesale||0);
      default: return a.name.localeCompare(b.name,'ar');
    }
  });

  const tbody = document.getElementById("invTbody");
  if(!tbody) return;

  tbody.innerHTML = items.map((x,i)=>{
    const stockPill = x.qty <= 0 ? `<span class="pill bad">Ù†ÙØ¯</span>` : (x.qty <= 3 ? `<span class="pill warn">Ù‚Ù„ÙŠÙ„</span>` : `<span class="pill ok">Ù…ØªÙˆÙØ±</span>`);
    return `
      <tr>
        <td>${i+1}</td>
        <td>
          <div style="display:flex; gap:10px; align-items:center;">
            <div>${escapeHtml(x.name)}</div>
            ${stockPill}
          </div>
          ${x.note ? `<div class="mini">${escapeHtml(x.note)}</div>` : ``}
        </td>
        <td>${nfmt(x.wholesale)}</td>
        <td>${nfmt(x.qty)}</td>
        <td>${nfmt(x.profit)}</td>
        <td class="right">
          <button class="btn" onclick="openInventoryModal('${x.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        </td>
      </tr>
    `;
  }).join("");

  const totalItems = state.inventory.length;
  const totalQty = state.inventory.reduce((s,x)=>s+(toNum(x.qty)),0);
  document.getElementById("invSummary").textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${nfmt(totalItems)} | Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø·Ø¹: ${nfmt(totalQty)}`;
}

/* ===========================
   SHOPPING LIST
=========================== */
function saveShopNote(){
  state.shopNote = (document.getElementById("shopNote")?.value || "");
  localStorage.setItem(LS_KEYS.shopNote, state.shopNote);
  renderShopping();
}
function openAddToShoppingModal(editRowId=null){
  const isEdit = !!editRowId;
  const row = isEdit ? state.shopping.find(x=>x.id===editRowId) : null;

  // source from inventory
  const inv = [...state.inventory].sort((a,b)=>a.name.localeCompare(b.name,'ar'));

  const body = `
    <div class="panel" style="margin-bottom:12px">
      <div class="muted" style="font-size:12.5px; line-height:1.8">
        Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†. Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© Ø³ÙŠÙØ³Ø­Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†ØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©.
      </div>
    </div>

    <div class="row">
      <div class="field w8">
        <label>Ø§Ù„Ù…Ù†ØªØ¬ (Ø¨Ø­Ø«/Ø§Ø®ØªÙŠØ§Ø±)</label>
        <input id="m_shop_search" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«..." value="${row ? escapeHtml(getInvName(row.invId)) : ""}" oninput="filterShopProducts()" />
        <div id="m_shop_suggestions" style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;"></div>
      </div>
      <div class="field w4">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input id="m_shop_qty" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 2" value="${row ? row.qty : "1"}" />
      </div>

      <div class="field w6">
        <label>Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© (ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†)</label>
        <input id="m_shop_wh" inputmode="decimal" disabled value="${row ? nfmt(getInvWholesale(row.invId)) : "0"}" />
      </div>
      <div class="field w6">
        <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label>
        <input id="m_shop_total" disabled value="${row ? nfmt(calcRowTotal(row.invId, row.qty)) : "0"}" />
      </div>

      <input type="hidden" id="m_shop_invId" value="${row ? row.invId : ""}">
      <div class="field w12">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="m_shop_note" placeholder="Ù…Ø«Ø§Ù„: Ù„ÙˆÙ† / Ù†ÙˆØ¹ / ØªÙØ§ØµÙŠÙ„" value="${row?.note ? escapeHtml(row.note) : ""}">
      </div>
    </div>
  `;

  const foot = `
    <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    ${isEdit ? `<button class="btn danger" onclick="deleteShoppingRow('${editRowId}')">Ø­Ø°Ù</button>` : ``}
    <button class="btn ok" onclick="${isEdit ? `saveShoppingEdit('${editRowId}')` : `saveShoppingNew()`}">
      ${isEdit ? "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„" : "Ø¥Ø¶Ø§ÙØ©"}
    </button>
  `;

  openModal(isEdit ? "ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚" : "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚", body, foot);

  // init suggestions
  filterShopProducts();

  // live calc
  const qtyEl = document.getElementById("m_shop_qty");
  qtyEl.addEventListener("input", ()=>{
    const invId = val("m_shop_invId");
    const qty = Math.max(0, Math.floor(toNum(val("m_shop_qty"))));
    document.getElementById("m_shop_total").value = nfmt(calcRowTotal(invId, qty));
  });
}
function filterShopProducts(){
  const q = (val("m_shop_search")||"").trim().toLowerCase();
  const sug = document.getElementById("m_shop_suggestions");
  if(!sug) return;

  let items = [...state.inventory].sort((a,b)=>a.name.localeCompare(b.name,'ar'));
  if(q) items = items.filter(x => x.name.toLowerCase().includes(q));

  // show up to 12
  items = items.slice(0, 12);

  sug.innerHTML = items.map(x=>{
    const wh = nfmt(x.wholesale);
    const qtyPill = x.qty <= 0 ? "bad" : (x.qty <= 3 ? "warn" : "ok");
    const qtyLabel = x.qty <= 0 ? "Ù†ÙØ¯" : `Ù…ØªÙˆÙØ±: ${nfmt(x.qty)}`;
    return `
      <button class="btn" style="border-radius:14px" onclick="selectShopProduct('${x.id}')">
        ${escapeHtml(x.name)} <span class="pill ${qtyPill}" style="margin-right:6px">${qtyLabel}</span>
        <span class="pill" style="margin-right:6px">Ø¬Ù…Ù„Ø©: ${wh}</span>
      </button>
    `;
  }).join("");

  // if only one and typed exact
  // no auto select
}
function selectShopProduct(invId){
  document.getElementById("m_shop_invId").value = invId;
  document.getElementById("m_shop_search").value = getInvName(invId);

  const wh = getInvWholesale(invId);
  document.getElementById("m_shop_wh").value = nfmt(wh);

  const qty = Math.max(0, Math.floor(toNum(val("m_shop_qty"))));
  document.getElementById("m_shop_total").value = nfmt(calcRowTotal(invId, qty));
}
function saveShoppingNew(){
  const invId = val("m_shop_invId");
  if(!invId){ toast("Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†"); return; }

  const qty = Math.max(1, Math.floor(toNum(val("m_shop_qty"))));
  const note = (val("m_shop_note")||"").trim();

  // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬: Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø²ÙŠØ¯ Ø§Ù„ÙƒÙ…ÙŠØ©
  const existing = state.shopping.find(r => r.invId === invId);
  if(existing){
    existing.qty = Math.max(1, Math.floor(toNum(existing.qty)) + qty);
    existing.note = existing.note || note;
    existing.updatedAt = Date.now();
  }else{
    state.shopping.unshift({ id:uid(), invId, qty, note, createdAt: Date.now() });
  }

  save(LS_KEYS.shopping, state.shopping);
  closeModal();
  renderShopping();
  toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
}
function saveShoppingEdit(id){
  const idx = state.shopping.findIndex(x=>x.id===id);
  if(idx<0) return;

  const invId = val("m_shop_invId");
  const qty = Math.max(1, Math.floor(toNum(val("m_shop_qty"))));
  const note = (val("m_shop_note")||"").trim();
  if(!invId){ toast("Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†"); return; }

  // Ù„Ùˆ Ø¹Ø¯Ù‘Ù„ Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ø¨ØµÙ Ø¢Ø®Ø± -> Ù†Ø¯Ù…Ø¬
  const clash = state.shopping.find(x => x.id!==id && x.invId===invId);
  if(clash){
    clash.qty = Math.max(1, Math.floor(toNum(clash.qty)) + qty);
    clash.note = clash.note || note;
    clash.updatedAt = Date.now();
    state.shopping.splice(idx,1);
  }else{
    state.shopping[idx] = { ...state.shopping[idx], invId, qty, note, updatedAt: Date.now() };
  }

  save(LS_KEYS.shopping, state.shopping);
  closeModal();
  renderShopping();
  toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
}
function deleteShoppingRow(id){
  state.shopping = state.shopping.filter(x=>x.id!==id);
  save(LS_KEYS.shopping, state.shopping);
  closeModal();
  renderShopping();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
}
function renderShopping(){
  // note
  const noteEl = document.getElementById("shopNote");
  if(noteEl) noteEl.value = state.shopNote || "";
  const notePreview = document.getElementById("shopNotePreview");
  if(notePreview) notePreview.textContent = state.shopNote ? `Ù…Ù„Ø§Ø­Ø¸Ø©: ${state.shopNote}` : "â€”";

  const tbody = document.getElementById("shopTbody");
  if(!tbody) return;

  // rows only if inv exists
  const validRows = state.shopping.filter(r => !!state.inventory.find(i=>i.id===r.invId));
  if(validRows.length !== state.shopping.length){
    state.shopping = validRows;
    save(LS_KEYS.shopping, state.shopping);
  }

  const rows = [...state.shopping].map(r=>{
    const name = getInvName(r.invId);
    const wh = getInvWholesale(r.invId);
    const total = calcRowTotal(r.invId, r.qty);
    return { ...r, name, wholesale: wh, total };
  });

  tbody.innerHTML = rows.map((r,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>
        <div>${escapeHtml(r.name)}</div>
        ${r.note ? `<div class="mini">${escapeHtml(r.note)}</div>` : ``}
      </td>
      <td>${nfmt(r.qty)}</td>
      <td>${nfmt(r.wholesale)}</td>
      <td><span class="pill ok">${nfmt(r.total)}</span></td>
      <td class="right">
        <button class="btn" onclick="openAddToShoppingModal('${r.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
      </td>
    </tr>
  `).join("");

  const grand = rows.reduce((s,r)=>s + toNum(r.total), 0);
  document.getElementById("shopTotal").textContent = `${nfmt(grand)} Ø¯ÙŠÙ†Ø§Ø±`;
}
function printShopping(){
  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¥Ø°Ø§ Ù…Ø´ ÙÙŠÙ‡Ø§
  go("shopping");
  setTimeout(()=>window.print(), 250);
}

/* ===========================
   TASKS
=========================== */
function openTaskModal(editId=null){
  const isEdit = !!editId;
  const t = isEdit ? state.tasks.find(x=>x.id===editId) : null;

  const body = `
    <div class="row">
      <div class="field w8">
        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</label>
        <input id="m_task_title" placeholder="Ù…Ø«Ø§Ù„: ØªØ±ØªÙŠØ¨ Ø±ÙÙˆÙ Ø§Ù„Ù…Ø­Ù„" value="${t?.title ? escapeHtml(t.title) : ""}">
      </div>

      <div class="field w4">
        <label>Ø§Ù„Ù†ÙˆØ¹</label>
        <select id="m_task_type">
          <option value="daily" ${t?.type==="daily"?"selected":""}>ÙŠÙˆÙ…ÙŠØ©</option>
          <option value="weekly" ${t?.type==="weekly"?"selected":""}>Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</option>
          <option value="monthly" ${t?.type==="monthly"?"selected":""}>Ø´Ù‡Ø±ÙŠØ©</option>
        </select>
      </div>

      <div class="field w4">
        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ°ÙƒÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="m_task_date" type="date" value="${t?.date ? t.date : ""}">
      </div>

      <div class="field w4">
        <label>Ø£ÙˆÙ„ÙˆÙŠØ©</label>
        <select id="m_task_pri">
          <option value="low" ${t?.priority==="low"?"selected":""}>Ù…Ù†Ø®ÙØ¶Ø©</option>
          <option value="med" ${!t || t?.priority==="med"?"selected":""}>Ù…ØªÙˆØ³Ø·Ø©</option>
          <option value="high" ${t?.priority==="high"?"selected":""}>Ø¹Ø§Ù„ÙŠØ©</option>
        </select>
      </div>

      <div class="field w4">
        <label>ØªÙ…ÙŠÙŠØ² â­</label>
        <select id="m_task_star">
          <option value="0" ${t?.star ? "" : "selected"}>Ù„Ø§</option>
          <option value="1" ${t?.star ? "selected" : ""}>Ù†Ø¹Ù…</option>
        </select>
      </div>

      <div class="field w12">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <textarea id="m_task_note" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©â€¦">${t?.note ? escapeHtml(t.note) : ""}</textarea>
      </div>
    </div>
  `;
  const foot = `
    <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    ${isEdit ? `<button class="btn danger" onclick="deleteTask('${editId}')">Ø­Ø°Ù</button>` : ``}
    <button class="btn ok" onclick="${isEdit ? `saveTaskEdit('${editId}')` : `saveTaskNew()`}">
      ${isEdit ? "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„" : "Ø¥Ø¶Ø§ÙØ©"}
    </button>
  `;
  openModal(isEdit ? "ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‡Ù…Ø©" : "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©", body, foot);
}
function saveTaskNew(){
  const title = val("m_task_title").trim();
  if(!title){ toast("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©"); return; }
  const type = val("m_task_type");
  const date = val("m_task_date");
  const priority = val("m_task_pri");
  const star = val("m_task_star")==="1";
  const note = val("m_task_note").trim();

  state.tasks.unshift({ id:uid(), title, type, date, priority, star, done:false, note, createdAt:Date.now() });
  save(LS_KEYS.tasks, state.tasks);
  closeModal();
  renderTasks();
  toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
}
function saveTaskEdit(id){
  const idx = state.tasks.findIndex(x=>x.id===id);
  if(idx<0) return;

  const title = val("m_task_title").trim();
  if(!title){ toast("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©"); return; }
  const type = val("m_task_type");
  const date = val("m_task_date");
  const priority = val("m_task_pri");
  const star = val("m_task_star")==="1";
  const note = val("m_task_note").trim();

  state.tasks[idx] = { ...state.tasks[idx], title, type, date, priority, star, note, updatedAt:Date.now() };
  save(LS_KEYS.tasks, state.tasks);
  closeModal();
  renderTasks();
  toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
}
function deleteTask(id){
  state.tasks = state.tasks.filter(x=>x.id!==id);
  save(LS_KEYS.tasks, state.tasks);
  closeModal();
  renderTasks();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
}
function toggleTaskDone(id){
  const t = state.tasks.find(x=>x.id===id);
  if(!t) return;
  t.done = !t.done;
  t.updatedAt = Date.now();
  save(LS_KEYS.tasks, state.tasks);
  renderTasks();
}
function toggleTaskStar(id){
  const t = state.tasks.find(x=>x.id===id);
  if(!t) return;
  t.star = !t.star;
  t.updatedAt = Date.now();
  save(LS_KEYS.tasks, state.tasks);
  renderTasks();
}
function renderTasks(){
  const q = (document.getElementById("taskSearch")?.value || "").trim().toLowerCase();
  const f = document.getElementById("taskFilter")?.value || "all";

  let tasks = [...state.tasks];

  if(q){
    tasks = tasks.filter(t => (t.title||"").toLowerCase().includes(q) || (t.note||"").toLowerCase().includes(q));
  }

  if(f==="daily" || f==="weekly" || f==="monthly"){
    tasks = tasks.filter(t=>t.type===f);
  }else if(f==="star"){
    tasks = tasks.filter(t=>!!t.star);
  }else if(f==="done"){
    tasks = tasks.filter(t=>!!t.done);
  }else if(f==="todo"){
    tasks = tasks.filter(t=>!t.done);
  }

  // ØªØ±ØªÙŠØ¨ Ø°ÙƒÙŠ: Ø§Ù„Ù…Ù…ÙŠØ² Ø«Ù… Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø«Ù… Ø§Ù„ØªØ§Ø±ÙŠØ®
  const priRank = { high:0, med:1, low:2 };
  tasks.sort((a,b)=>{
    if(!!b.star !== !!a.star) return (b.star?1:0) - (a.star?1:0);
    if(!!a.done !== !!b.done) return (a.done?1:0) - (b.done?1:0);
    return (priRank[a.priority]||9) - (priRank[b.priority]||9);
  });

  const grid = document.getElementById("tasksGrid");
  if(!grid) return;

  grid.innerHTML = tasks.map(t=>{
    const typeLabel = t.type==="daily"?"ÙŠÙˆÙ…ÙŠØ©":(t.type==="weekly"?"Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©":"Ø´Ù‡Ø±ÙŠØ©");
    const priPill = t.priority==="high" ? "bad" : (t.priority==="med" ? "warn" : "ok");
    const priLabel = t.priority==="high" ? "Ø¹Ø§Ù„ÙŠØ©" : (t.priority==="med" ? "Ù…ØªÙˆØ³Ø·Ø©" : "Ù…Ù†Ø®ÙØ¶Ø©");
    const donePill = t.done ? `<span class="pill ok">Ù…ÙƒØªÙ…Ù„Ø© âœ…</span>` : `<span class="pill">ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©</span>`;
    const datePill = t.date ? `<span class="pill">ğŸ“… ${escapeHtml(t.date)}</span>` : `<span class="pill muted">Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®</span>`;
    return `
      <div class="taskCard">
        <div class="taskTop">
          <div style="flex:1">
            <h3 class="taskTitle">${escapeHtml(t.title)} ${t.star ? "â­" : ""}</h3>
            ${t.note ? `<div class="muted" style="margin-top:6px; line-height:1.7; font-size:12.5px">${escapeHtml(t.note)}</div>` : ``}
          </div>
          <button class="btn" onclick="openTaskModal('${t.id}')">âœï¸</button>
        </div>

        <div class="taskMeta">
          <span class="pill">${typeLabel}</span>
          <span class="pill ${priPill}">Ø£ÙˆÙ„ÙˆÙŠØ©: ${priLabel}</span>
          ${datePill}
          ${donePill}
        </div>

        <div class="taskActions">
          <button class="btn ${t.done ? "" : "ok"}" onclick="toggleTaskDone('${t.id}')">${t.done ? "â†©ï¸ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„" : "âœ… Ø¥ÙƒÙ…Ø§Ù„"}</button>
          <button class="btn" onclick="toggleTaskStar('${t.id}')">${t.star ? "â­ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ²" : "â­ ØªÙ…ÙŠÙŠØ²"}</button>
          <button class="btn danger" onclick="deleteTask('${t.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
      </div>
    `;
  }).join("");

  const total = state.tasks.length;
  const done = state.tasks.filter(t=>t.done).length;
  const star = state.tasks.filter(t=>t.star).length;
  document.getElementById("taskSummary").textContent = `Ø§Ù„ÙƒÙ„: ${nfmt(total)} | Ù…ÙƒØªÙ…Ù„Ø©: ${nfmt(done)} | Ù…Ù…ÙŠØ²Ø©: ${nfmt(star)}`;
}

/* ===========================
   FUTURE LISTS
=========================== */
function openFutureListModal(editId=null){
  const isEdit = !!editId;
  const L = isEdit ? state.future.find(x=>x.id===editId) : null;

  const body = `
    <div class="row">
      <div class="field w8">
        <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</label>
        <input id="m_f_title" placeholder="Ù…Ø«Ø§Ù„: ØªØ¬Ù‡ÙŠØ²Ø§Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©" value="${L?.title ? escapeHtml(L.title) : ""}">
      </div>
      <div class="field w4">
        <label>Ù…ÙˆØ¹Ø¯ ØªÙ‚Ø±ÙŠØ¨ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="m_f_when" type="month" value="${L?.when ? L.when : ""}">
      </div>

      <div class="field w12">
        <label>ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <textarea id="m_f_desc" placeholder="ØªÙØ§ØµÙŠÙ„â€¦">${L?.desc ? escapeHtml(L.desc) : ""}</textarea>
      </div>
    </div>
  `;
  const foot = `
    <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    ${isEdit ? `<button class="btn danger" onclick="deleteFutureList('${editId}')">Ø­Ø°Ù</button>` : ``}
    <button class="btn ok" onclick="${isEdit ? `saveFutureListEdit('${editId}')` : `saveFutureListNew()`}">
      ${isEdit ? "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„" : "Ø¥Ø¶Ø§ÙØ©"}
    </button>
  `;
  openModal(isEdit ? "ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©" : "Ù‚Ø§Ø¦Ù…Ø© Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©", body, foot);
}
function saveFutureListNew(){
  const title = val("m_f_title").trim();
  if(!title){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"); return; }
  const when = val("m_f_when");
  const desc = val("m_f_desc").trim();

  state.future.unshift({ id:uid(), title, when, desc, items:[], createdAt:Date.now() });
  save(LS_KEYS.future, state.future);
  closeModal();
  renderFuture();
  toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
}
function saveFutureListEdit(id){
  const idx = state.future.findIndex(x=>x.id===id);
  if(idx<0) return;

  const title = val("m_f_title").trim();
  if(!title){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"); return; }
  const when = val("m_f_when");
  const desc = val("m_f_desc").trim();

  state.future[idx] = { ...state.future[idx], title, when, desc, updatedAt:Date.now() };
  save(LS_KEYS.future, state.future);
  closeModal();
  renderFuture();
  toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
}
function deleteFutureList(id){
  state.future = state.future.filter(x=>x.id!==id);
  save(LS_KEYS.future, state.future);
  closeModal();
  renderFuture();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
}
function openFutureItemModal(listId, itemId=null){
  const L = state.future.find(x=>x.id===listId);
  if(!L) return;
  const isEdit = !!itemId;
  const it = isEdit ? L.items.find(i=>i.id===itemId) : null;

  const body = `
    <div class="row">
      <div class="field w8">
        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ÙØ±Ø¹ÙŠ</label>
        <input id="m_fi_title" placeholder="Ù…Ø«Ø§Ù„: Ø³ØªØ§Ù†Ø¯ Ø¹Ø±Ø¶" value="${it?.title ? escapeHtml(it.title) : ""}">
      </div>
      <div class="field w4">
        <label>Ø§Ù„ØªÙƒÙ„ÙØ© (ÙØ±Ø¯ÙŠØ©)</label>
        <input id="m_fi_cost" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 25000" value="${it ? it.cost : ""}">
      </div>
      <div class="field w12">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="m_fi_note" placeholder="ØªÙØ§ØµÙŠÙ„â€¦" value="${it?.note ? escapeHtml(it.note) : ""}">
      </div>
    </div>
  `;
  const foot = `
    <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    ${isEdit ? `<button class="btn danger" onclick="deleteFutureItem('${listId}','${itemId}')">Ø­Ø°Ù</button>` : ``}
    <button class="btn ok" onclick="${isEdit ? `saveFutureItemEdit('${listId}','${itemId}')` : `saveFutureItemNew('${listId}')`}">
      ${isEdit ? "Ø­ÙØ¸" : "Ø¥Ø¶Ø§ÙØ©"}
    </button>
  `;
  openModal(isEdit ? "ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ±" : "Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ÙØ±Ø¹ÙŠ", body, foot);
}
function saveFutureItemNew(listId){
  const L = state.future.find(x=>x.id===listId);
  if(!L) return;

  const title = val("m_fi_title").trim();
  const cost = toNum(val("m_fi_cost"));
  const note = val("m_fi_note").trim();
  if(!title){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±"); return; }

  L.items.unshift({ id:uid(), title, cost, note, done:false, createdAt:Date.now() });
  save(LS_KEYS.future, state.future);
  closeModal();
  renderFuture();
  toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
}
function saveFutureItemEdit(listId, itemId){
  const L = state.future.find(x=>x.id===listId);
  if(!L) return;
  const idx = L.items.findIndex(i=>i.id===itemId);
  if(idx<0) return;

  const title = val("m_fi_title").trim();
  const cost = toNum(val("m_fi_cost"));
  const note = val("m_fi_note").trim();
  if(!title){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±"); return; }

  L.items[idx] = { ...L.items[idx], title, cost, note, updatedAt:Date.now() };
  save(LS_KEYS.future, state.future);
  closeModal();
  renderFuture();
  toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
}
function deleteFutureItem(listId, itemId){
  const L = state.future.find(x=>x.id===listId);
  if(!L) return;
  L.items = L.items.filter(i=>i.id!==itemId);
  save(LS_KEYS.future, state.future);
  closeModal();
  renderFuture();
  toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
}
function toggleFutureItemDone(listId, itemId){
  const L = state.future.find(x=>x.id===listId);
  if(!L) return;
  const it = L.items.find(i=>i.id===itemId);
  if(!it) return;
  it.done = !it.done;
  it.updatedAt = Date.now();
  save(LS_KEYS.future, state.future);
  renderFuture();
}
function renderFuture(){
  const q = (document.getElementById("futureSearch")?.value || "").trim().toLowerCase();
  let lists = [...state.future];

  if(q) lists = lists.filter(L => (L.title||"").toLowerCase().includes(q) || (L.desc||"").toLowerCase().includes(q));

  // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„ÙƒÙ„ Ù‚Ø§Ø¦Ù…Ø©
  const listTotal = (L) => (L.items||[]).reduce((s,i)=>s + toNum(i.cost), 0);

  const wrap = document.getElementById("futureLists");
  if(!wrap) return;

  wrap.innerHTML = lists.map(L=>{
    const total = listTotal(L);
    const doneCount = (L.items||[]).filter(i=>i.done).length;
    const allCount = (L.items||[]).length;

    return `
      <div class="futureCard">
        <div style="display:flex; justify-content:space-between; gap:10px; align-items:flex-start;">
          <div style="flex:1">
            <h4>${escapeHtml(L.title)}</h4>
            <div class="futureSub">
              ${L.when ? `ğŸ“… ${escapeHtml(L.when)} â€¢ ` : ``}
              Ø¹Ù†Ø§ØµØ±: ${nfmt(allCount)} â€¢ Ù…ÙƒØªÙ…Ù„: ${nfmt(doneCount)}
            </div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" onclick="openFutureListModal('${L.id}')">âœï¸</button>
          </div>
        </div>

        ${L.desc ? `<div class="muted" style="font-size:12.5px; line-height:1.7">${escapeHtml(L.desc)}</div>` : ``}

        <div class="taskMeta" style="margin-top:10px">
          <span class="pill warn">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${nfmt(total)} Ø¯ÙŠÙ†Ø§Ø±</span>
          <button class="btn ok" onclick="openFutureItemModal('${L.id}')">â• Ø¹Ù†ØµØ± ÙØ±Ø¹ÙŠ</button>
          <button class="btn danger" onclick="deleteFutureList('${L.id}')">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>

        <div class="subitems">
          ${(L.items||[]).length ? (L.items||[]).map(it=>{
            return `
              <div class="subitem">
                <div style="min-width:0">
                  <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
                    <strong style="font-size:13px">${escapeHtml(it.title)}</strong>
                    ${it.done ? `<span class="pill ok">ØªÙ… âœ…</span>` : `<span class="pill">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>`}
                    <span class="pill">${nfmt(it.cost)} Ø¯ÙŠÙ†Ø§Ø±</span>
                  </div>
                  ${it.note ? `<div class="muted" style="font-size:12.5px; margin-top:6px; line-height:1.6">${escapeHtml(it.note)}</div>` : ``}
                </div>
                <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                  <button class="btn ${it.done ? "" : "ok"}" onclick="toggleFutureItemDone('${L.id}','${it.id}')">${it.done ? "â†©ï¸" : "âœ…"}</button>
                  <button class="btn" onclick="openFutureItemModal('${L.id}','${it.id}')">âœï¸</button>
                  <button class="btn danger" onclick="deleteFutureItem('${L.id}','${it.id}')">ğŸ—‘ï¸</button>
                </div>
              </div>
            `;
          }).join("") : `<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙØ±Ø¹ÙŠØ© Ø¨Ø¹Ø¯ â€” Ø§Ø¶ØºØ· â€œâ• Ø¹Ù†ØµØ± ÙØ±Ø¹ÙŠâ€.</div>`}
        </div>
      </div>
    `;
  }).join("");

  const grand = state.future.reduce((s,L)=> s + (L.items||[]).reduce((ss,i)=>ss+toNum(i.cost),0), 0);
  document.getElementById("futureGrandTotal").textContent = `${nfmt(grand)} Ø¯ÙŠÙ†Ø§Ø±`;
}

/* ===========================
   Helpers
=========================== */
function getInvName(id){
  const x = state.inventory.find(i=>i.id===id);
  return x ? x.name : "â€”";
}
function getInvWholesale(id){
  const x = state.inventory.find(i=>i.id===id);
  return x ? toNum(x.wholesale) : 0;
}
function calcRowTotal(invId, qty){
  return getInvWholesale(invId) * Math.max(0, Math.floor(toNum(qty)));
}
function val(id){
  const el = document.getElementById(id);
  return el ? el.value : "";
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ===========================
   Boot
=========================== */
(function init(){
  // Ø²Ø±Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ØªØ³ÙˆÙ‚
  const noteEl = document.getElementById("shopNote");
  if(noteEl) noteEl.value = state.shopNote || "";

  // Ù„Ùˆ Ø§Ù„Ù…Ø®Ø²Ù† ÙØ§Ø¶ÙŠ: Ø¶Ø¹ Ù…Ø«Ø§Ù„ÙŠÙ† Ø§Ø®ØªÙŠØ§Ø±ÙŠÙŠÙ† (Ù…Ø¹Ù„Ù‘Ù‚)
  // if(state.inventory.length===0){
  //   state.inventory = [
  //     {id:uid(), name:"ÙƒÙŠØ¨Ù„ ØªØ§ÙŠØ¨ Ø³ÙŠ", wholesale:2500, qty:10, profit:500, note:"Ø¬ÙˆØ¯Ø© Ù…Ù…ØªØ§Ø²Ø©", createdAt:Date.now()},
  //     {id:uid(), name:"Ø´Ø§Ø­Ù† Ø³Ø±ÙŠØ¹", wholesale:8000, qty:5, profit:1500, note:"USB-C PD", createdAt:Date.now()},
  //   ];
  //   save(LS_KEYS.inventory, state.inventory);
  // }

  // Render initial (home only)
})();
</script>
</body>
</html>
